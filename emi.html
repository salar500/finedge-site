<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Paisa - EMI & Mortgage Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background-color: #f9fafb;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 6rem 1rem 4rem; /* space for fixed header & footer */
    }

    .container {
      max-width: 650px;
      width: 100%;
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      padding: 2rem;
    }

    input[type=range] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 5px;
      outline: none;
      background: linear-gradient(to right, #10B981 0%, #10B981 0%, #e5e7eb 0%, #e5e7eb 100%);
      transition: background 0.2s ease;
    }

    input[type=range]:hover { opacity: 0.9; }

    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px; height: 20px; border-radius: 50%;
      background: #10B981; border: 2px solid white; cursor: pointer;
      box-shadow: 0 0 4px rgba(0,0,0,0.3);
    }

    .pie-wrapper {
      position: relative;
      width: 240px;
      height: 240px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .pie-wrapper svg {
      width: 100%;
      height: 100%;
      overflow: visible;
    }
  </style>
</head>

<body>
  <!-- Header placeholder -->
  <div id="site-header"></div>

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-white shadow-lg z-50 p-4">
    <h2 class="text-lg font-semibold text-emerald-600 mb-4">Calculators</h2>
    <ul class="space-y-3">
      <li><a href="index.html" class="block px-3 py-2 rounded hover:bg-emerald-50 text-gray-800">üè† Home</a></li>
      <li><a href="emi.html" class="block px-3 py-2 rounded bg-emerald-50 text-emerald-700 font-medium">üíµ EMI Calculator</a></li>
      <li><a href="sip.html" class="block px-3 py-2 rounded hover:bg-emerald-50 text-gray-800">üìà SIP Calculator</a></li>
      <li><a href="#" class="block px-3 py-2 rounded text-gray-400 cursor-not-allowed">üí∞ SWP Calculator (Coming Soon)</a></li>
    </ul>
    <button id="closeSidebar" class="mt-6 text-sm text-gray-500 hover:text-emerald-600">Close Menu</button>
  </aside>

  <!-- Overlay -->
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-40 hidden"></div>

  <!-- Main content -->
  <main>
    <div class="container">
      <h2 class="text-xl font-semibold text-gray-800 mb-6 text-center">Mortgage / EMI Calculator</h2>

      <!-- Inputs -->
      <div class="space-y-8">
        <div>
          <label class="text-sm font-medium text-gray-700">Home Value (‚Çπ)</label>
          <input id="homeValue" type="number" min="50000" max="2000000" step="10000" value="500000"
            class="block w-full bg-green-50 rounded px-3 py-2 mt-1 outline-none font-semibold text-gray-800">
          <input id="homeValueSlider" type="range" min="50000" max="2000000" step="10000" value="500000" class="mt-3 slider">
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700">Down Payment (‚Çπ)</label>
          <input id="downPayment" type="number" min="0" max="2000000" step="10000" value="100000"
            class="block w-full bg-green-50 rounded px-3 py-2 mt-1 outline-none font-semibold text-gray-800">
          <input id="downPaymentSlider" type="range" min="0" max="2000000" step="10000" value="100000" class="mt-3 slider">
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700">Loan Amount (‚Çπ)</label>
          <input id="loanAmount" type="number" readonly
            class="block w-full bg-gray-100 rounded px-3 py-2 mt-1 outline-none font-semibold text-gray-800">
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700">Interest Rate (%)</label>
          <input id="rate" type="number" min="1" max="20" step="0.1" value="7"
            class="block w-full bg-green-50 rounded px-3 py-2 mt-1 outline-none font-semibold text-gray-800">
          <input id="rateSlider" type="range" min="1" max="20" step="0.1" value="7" class="mt-3 slider">
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700">Loan Term (Years)</label>
          <input id="years" type="number" min="1" max="40" step="1" value="20"
            class="block w-full bg-green-50 rounded px-3 py-2 mt-1 outline-none font-semibold text-gray-800">
          <input id="yearsSlider" type="range" min="1" max="40" step="1" value="20" class="mt-3 slider">
        </div>
      </div>

      <!-- Output -->
      <div class="mt-10 text-center">
        <h3 class="text-lg font-semibold text-gray-700 mb-4">Mortgage Breakdown</h3>
        <div class="flex flex-col items-center justify-center pie-wrapper">
          <svg id="pieChart" viewBox="0 0 36 36" class="transform -rotate-90">
            <circle cx="18" cy="18" r="15.915" fill="none" stroke="#E5E7EB" stroke-width="6"></circle>
            <circle id="principalArc" cx="18" cy="18" r="15.915" fill="none" stroke="#A7F3D0" stroke-width="6"
              stroke-dasharray="0 100" stroke-linecap="round"></circle>
            <circle id="interestArc" cx="18" cy="18" r="15.915" fill="none" stroke="#047857" stroke-width="6"
              stroke-dasharray="0 100" stroke-linecap="round"></circle>
          </svg>
        </div>
        <p id="monthlyPayment" class="mt-4 text-base font-semibold text-emerald-700"></p>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <div id="site-footer"></div>

  <script>
    // Sidebar toggle
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const closeSidebar = document.getElementById('closeSidebar');

    function toggleSidebar(show) {
      sidebar.classList.toggle('open', show);
      overlay.classList.toggle('hidden', !show);
    }

    document.addEventListener('click', (e) => {
      if (e.target.id === 'menuBtn') toggleSidebar(true);
      if (e.target.id === 'closeSidebar' || e.target.id === 'overlay') toggleSidebar(false);
    });

    // Inject header & footer
    Promise.all([
      fetch('header.html').then(r => r.text()).then(html => document.getElementById('site-header').innerHTML = html),
      fetch('footer.html').then(r => r.text()).then(html => document.getElementById('site-footer').innerHTML = html)
    ]).catch(err => console.warn('Header/Footer load failed', err));

    // Slider & calculation logic
    function updateSliderFill(slider) {
      const min = slider.min || 0, max = slider.max || 100, value = slider.value;
      const pct = ((value - min) * 100) / (max - min);
      slider.style.background = `linear-gradient(to right,#10B981 0%,#10B981 ${pct}%,#e5e7eb ${pct}%,#e5e7eb 100%)`;
    }

    function calculateMortgage() {
      const homeValue = parseFloat(homeValueEl.value) || 0;
      const downPayment = parseFloat(downPaymentEl.value) || 0;
      const loanAmount = homeValue - downPayment;
      loanAmountEl.value = loanAmount;
      const rate = parseFloat(rateEl.value) / 100 / 12;
      const years = parseFloat(yearsEl.value);
      const months = years * 12;
      const emi = (loanAmount * rate) / (1 - Math.pow(1 + rate, -months));
      monthlyPaymentEl.innerText = `Estimated Monthly EMI: ‚Çπ${emi.toFixed(2)}`;
    }

    const homeValueEl = document.getElementById('homeValue');
    const homeValueSlider = document.getElementById('homeValueSlider');
    const downPaymentEl = document.getElementById('downPayment');
    const downPaymentSlider = document.getElementById('downPaymentSlider');
    const rateEl = document.getElementById('rate');
    const rateSlider = document.getElementById('rateSlider');
    const yearsEl = document.getElementById('years');
    const yearsSlider = document.getElementById('yearsSlider');
    const loanAmountEl = document.getElementById('loanAmount');
    const monthlyPaymentEl = document.getElementById('monthlyPayment');

    [homeValueEl, downPaymentEl, rateEl, yearsEl].forEach(el => el.addEventListener('input', calculateMortgage));
    [homeValueSlider, downPaymentSlider, rateSlider, yearsSlider].forEach(slider => {
      slider.addEventListener('input', () => {
        const inputId = slider.id.replace('Slider', '');
        document.getElementById(inputId).value = slider.value;
        updateSliderFill(slider);
        calculateMortgage();
      });
      updateSliderFill(slider);
    });

    calculateMortgage();
  </script>
</body>
</html>
