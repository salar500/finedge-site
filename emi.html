<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Paisa - EMI & Mortgage Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background-color: #f9fafb;
      margin: 0;
    }
    .container {
      flex: 1;
      max-width: 650px;
      width: 100%;
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      padding: 2rem;
      margin: 7rem auto 4rem; /* space for fixed header */
    }
    input[type=range] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 5px;
      outline: none;
      background: linear-gradient(to right, #10B981 0%, #10B981 0%, #e5e7eb 0%, #e5e7eb 100%);
      transition: background 0.2s ease;
    }
    input[type=range]:hover { opacity: 0.9; }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px; height: 20px; border-radius: 50%;
      background: #10B981; border: 2px solid white; cursor: pointer;
      box-shadow: 0 0 4px rgba(0,0,0,0.3);
    }
    .pie-wrapper {
      position: relative;
      width: 240px;
      height: 240px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .pie-wrapper svg {
      width: 100%;
      height: 100%;
      overflow: visible;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <div id="site-header"></div>

  <!-- Sidebar -->
  <div id="site-sidebar"></div>

  <!-- Overlay -->
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-40 hidden z-40"></div>

  <!-- Main content -->
  <div class="container">
    <h2 class="text-xl font-semibold text-gray-800 mb-6 text-center">Mortgage / EMI Calculator</h2>

    <!-- Inputs -->
    <div class="space-y-8">
      <!-- All your sliders & inputs (unchanged) -->
      <!-- ... your calculator input blocks ... -->
    </div>

    <!-- Output -->
    <div class="mt-10 text-center">
      <h3 class="text-lg font-semibold text-gray-700 mb-4">Mortgage Breakdown</h3>
      <div class="flex flex-col items-center justify-center pie-wrapper">
        <svg id="pieChart" viewBox="0 0 36 36" class="transform -rotate-90">
          <circle cx="18" cy="18" r="15.915" fill="none" stroke="#E5E7EB" stroke-width="6"></circle>
          <circle id="principalArc" cx="18" cy="18" r="15.915" fill="none" stroke="#A7F3D0" stroke-width="6"
            stroke-dasharray="0 100" stroke-linecap="round"></circle>
          <circle id="interestArc" cx="18" cy="18" r="15.915" fill="none" stroke="#047857" stroke-width="6"
            stroke-dasharray="0 100" stroke-linecap="round"></circle>
        </svg>
      </div>

      <div class="flex justify-center gap-4 mt-3 text-sm">
        <span class="flex items-center"><span class="w-3 h-3 bg-emerald-300 rounded-full mr-1"></span> Principal</span>
        <span class="flex items-center"><span class="w-3 h-3 bg-emerald-800 rounded-full mr-1"></span> Interest</span>
      </div>

      <div class="mt-4 text-sm text-gray-700">
        <table class="w-full text-left border mt-4">
          <thead class="bg-emerald-50">
            <tr>
              <th class="px-4 py-2 font-medium">Component</th>
              <th class="px-4 py-2 font-medium text-right">Amount ($)</th>
            </tr>
          </thead>
          <tbody id="breakdownTable" class="text-gray-700"></tbody>
        </table>
      </div>

      <p id="monthlyPayment" class="mt-4 text-base font-semibold text-emerald-700"></p>
      <p class="mt-2 text-sm text-gray-600 font-medium">
        Note: Calculations are based on monthly compounding for more accurate projections.
      </p>
    </div>
  </div>

  <!-- Footer -->
  <div id="site-footer"></div>

  <script>
    // Inject header, sidebar, and footer
    Promise.all([
      fetch('header.html').then(r => r.text()).then(html => document.getElementById('site-header').innerHTML = html),
      fetch('sidebar.html').then(r => r.text()).then(html => document.getElementById('site-sidebar').innerHTML = html),
      fetch('footer.html').then(r => r.text()).then(html => document.getElementById('site-footer').innerHTML = html)
    ]).then(() => {
      // Rebind menu toggle logic AFTER header/sidebar load
      // Sidebar handling after all includes are loaded
Promise.all([
  fetch('header.html').then(r => r.text()).then(html => document.getElementById('site-header').innerHTML = html),
  fetch('sidebar.html').then(r => r.text()).then(html => document.getElementById('site-sidebar').innerHTML = html),
  fetch('footer.html').then(r => r.text()).then(html => document.getElementById('site-footer').innerHTML = html)
]).then(() => {
  // Wait for DOM updates
  setTimeout(() => {
    const sidebar = document.querySelector('#sidebar');
    const overlay = document.querySelector('#overlay');
    const menuBtn = document.querySelector('#menuBtn');
    const closeSidebar = document.querySelector('#closeSidebar');

    function openSidebar() {
      sidebar?.classList.remove('-translate-x-full');
      overlay?.classList.remove('hidden');
    }
    function closeSidebarFunc() {
      sidebar?.classList.add('-translate-x-full');
      overlay?.classList.add('hidden');
    }

    menuBtn?.addEventListener('click', openSidebar);
    closeSidebar?.addEventListener('click', closeSidebarFunc);
    overlay?.addEventListener('click', closeSidebarFunc);
  }, 100); // short delay to ensure HTML injection
}).catch(err => console.warn('Header/Sidebar/Footer load failed', err));

  </script>

  <!-- Your existing calculator logic remains unchanged -->
  <script>
    function formatUSD(v){
      if(v >= 1000000) return "$" + (v/1000000).toFixed(2) + "M";
      if(v >= 1000) return "$" + (v/1000).toFixed(1) + "K";
      return "$" + v.toLocaleString();
    }
    function updateSliderFill(slider){
      const min=slider.min||0,max=slider.max||100,value=slider.value;
      const pct=((value-min)*100)/(max-min);
      slider.style.background=`linear-gradient(to right,#10B981 0%,#10B981 ${pct}%,#e5e7eb ${pct}%,#e5e7eb 100%)`;
    }

    function calculateMortgage(){
      const homeValue=parseFloat(document.getElementById('homeValue').value)||0;
      const downPayment=parseFloat(document.getElementById('downPayment').value)||0;
      const loanAmount=homeValue-downPayment;
      const rate=parseFloat(document.getElementById('rate').value)||0;
      const years=parseFloat(document.getElementById('years').value)||0;
      const propertyTax=parseFloat(document.getElementById('propertyTax').value)||0;
      const pmi=parseFloat(document.getElementById('pmi').value)||0;
      const insurance=parseFloat(document.getElementById('insurance').value)||0;

      document.getElementById('loanAmount').value = loanAmount;

      const monthlyRate=rate/100/12;
      const n=years*12;
      const monthlyTax=propertyTax/12;
      const monthlyInsurance=insurance/12;
      const monthlyPMI=(pmi/100*loanAmount)/12;

      const monthlyPrincipalInterest=(loanAmount*monthlyRate)/(1-Math.pow(1+monthlyRate,-n));
      const totalPayment=(monthlyPrincipalInterest+monthlyTax+monthlyInsurance+monthlyPMI)*n;
      const totalInterest=monthlyPrincipalInterest*n-loanAmount;
      const totalPrincipal=loanAmount;
      const totalTax=monthlyTax*n;
      const totalInsurance=monthlyInsurance*n;
      const totalPMI=monthlyPMI*n;

      const totalAll=totalPrincipal+totalInterest+totalTax+totalInsurance+totalPMI;

      const breakdown=[
        ["Principal", totalPrincipal],
        ["Interest", totalInterest],
        ["Property Tax", totalTax],
        ["PMI", totalPMI],
        ["Home Insurance", totalInsurance],
        ["Total Payment", totalAll]
      ];

      let html="";
      breakdown.forEach(([label, val])=>{
        html+=`<tr><td class='px-4 py-2 border'>${label}</td><td class='px-4 py-2 border text-right font-semibold'>${formatUSD(val)}</td></tr>`;
      });
      document.getElementById('breakdownTable').innerHTML=html;

      const pPct=(totalPrincipal/totalAll)*100;
      const iPct=(totalInterest/totalAll)*100;
      document.getElementById('principalArc').setAttribute('stroke-dasharray',pPct+' '+(100-pPct));
      document.getElementById('interestArc').setAttribute('stroke-dasharray',iPct+' '+(100-iPct));
      document.getElementById('interestArc').setAttribute('stroke-dashoffset',-pPct);

      document.getElementById('monthlyPayment').innerText = 
        "Estimated Monthly Payment: " + formatUSD(monthlyPrincipalInterest + monthlyTax + monthlyInsurance + monthlyPMI);
    }

    ['homeValue','downPayment','rate','years'].forEach(id=>{
      const input=document.getElementById(id);
      const slider=document.getElementById(id+'Slider');
      const updateAll=()=>{slider.value=input.value;updateSliderFill(slider);calculateMortgage();};
      input.addEventListener('input',updateAll);
      slider.addEventListener('input',()=>{input.value=slider.value;updateSliderFill(slider);calculateMortgage();});
      updateSliderFill(slider);
    });

    ['propertyTax','pmi','insurance'].forEach(id=>{
      document.getElementById(id).addEventListener('input',calculateMortgage);
    });

    calculateMortgage();
  </script>
</body>
  </html>
