<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home Loan Calculator - Paisa</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    input[type=range] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 5px;
      outline: none;
      background: linear-gradient(to right, #10B981 0%, #10B981 0%, #e5e7eb 0%, #e5e7eb 100%);
      transition: background 0.2s ease;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #10B981;
      border: 2px solid white;
      cursor: pointer;
      box-shadow: 0 0 4px rgba(0,0,0,0.3);
    }
    body {
      background-color: #f9fafb;
      margin: 0;
      padding-top: 4rem;
      font-family: system-ui, sans-serif;
    }
    .pie-wrapper { position: relative; width: 220px; height: 220px; margin: auto; }
    .pie-wrapper svg { width: 100%; height: 100%; overflow: visible; transform: rotate(-90deg); }
  </style>
</head>

<body>
  <div id="site-header"></div>
  <div id="site-sidebar"></div>
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-40 hidden z-40"></div>

  <main class="max-w-2xl mx-auto bg-white rounded-2xl shadow-md p-6 mt-10">
    <div class="flex items-center mb-6 justify-center">
      <div class="w-10 h-10 rounded-md bg-emerald-500 flex items-center justify-center shadow-sm">
        <span class="text-white text-xl font-bold">₹</span>
      </div>
      <div class="ml-3">
        <h1 class="text-2xl font-bold text-emerald-600 tracking-tight">Home Loan Calculator</h1>
      </div>
    </div>

    <div class="space-y-8">
      <div>
        <label class="text-sm font-medium text-gray-700">Property Value (₹)</label>
        <input id="propertyValue" type="number" min="100000" max="100000000" step="10000" value="5000000"
          class="block w-full bg-green-50 rounded px-3 py-2 mt-1 font-semibold text-gray-800">
      </div>

      <div>
        <label class="text-sm font-medium text-gray-700">Down Payment (₹)</label>
        <input id="downPayment" type="number" min="0" max="100000000" step="10000" value="1000000"
          class="block w-full bg-green-50 rounded px-3 py-2 mt-1 font-semibold text-gray-800">
        <div class="h-2 bg-gray-200 rounded-full mt-2 overflow-hidden">
          <div id="downBar" class="h-full bg-emerald-300 w-1/5 transition-all duration-300"></div>
        </div>
      </div>

      <div>
        <label class="text-sm font-medium text-gray-700">Loan Amount (₹)</label>
        <input id="loanAmount" type="number" min="10000" max="100000000" step="10000" value="4000000"
          class="block w-full bg-green-50 rounded px-3 py-2 mt-1 font-semibold text-gray-800">
        <p class="text-xs text-gray-500 mt-1">(Auto-adjusts so total = Property Value)</p>
        <div class="h-2 bg-gray-200 rounded-full mt-2 overflow-hidden">
          <div id="loanBar" class="h-full bg-emerald-600 w-4/5 transition-all duration-300"></div>
        </div>
      </div>

      <div>
        <label class="text-sm font-medium text-gray-700">Interest Rate (annual %)</label>
        <input id="rate" type="number" min="0" max="20" step="0.01" value="7.25"
          class="block w-full bg-green-50 rounded px-3 py-2 mt-1 font-semibold text-gray-800">
        <input id="rateSlider" type="range" min="0" max="20" step="0.01" value="7.25" class="mt-3 slider">
        <div class="flex justify-between text-xs text-gray-500 mt-1"><span>0%</span><span>20%</span></div>
      </div>

      <div>
        <label class="text-sm font-medium text-gray-700">Loan Tenure (years)</label>
        <input id="years" type="number" min="1" max="40" step="0.5" value="20"
          class="block w-full bg-green-50 rounded px-3 py-2 mt-1 font-semibold text-gray-800">
        <input id="yearsSlider" type="range" min="1" max="40" step="0.5" value="20" class="mt-3 slider">
        <div class="flex justify-between text-xs text-gray-500 mt-1"><span>1 yr</span><span>40 yrs</span></div>
      </div>
    </div>

    <div class="mt-10 text-center">
      <h3 class="text-lg font-semibold text-gray-700 mb-4">Loan Summary</h3>
      <div class="flex flex-col items-center justify-center pie-wrapper">
        <svg id="pieChart" viewBox="0 0 36 36">
          <circle cx="18" cy="18" r="15.915" fill="none" stroke="#E5E7EB" stroke-width="6"></circle>
          <circle id="principalArc" cx="18" cy="18" r="15.915" fill="none" stroke="#A7F3D0" stroke-width="6" stroke-dasharray="0 100" stroke-linecap="round"></circle>
          <circle id="interestArc" cx="18" cy="18" r="15.915" fill="none" stroke="#047857" stroke-width="6" stroke-dasharray="0 100" stroke-linecap="round"></circle>
        </svg>
      </div>
      <div class="mt-4 space-y-2 text-sm text-gray-700">
        <p><span class="inline-block w-3 h-3 bg-emerald-200 rounded-full mr-2"></span>Principal: <span id="principalText">₹0</span></p>
        <p><span class="inline-block w-3 h-3 bg-emerald-700 rounded-full mr-2"></span>Interest: <span id="interestText">₹0</span></p>
      </div>
      <p class="font-semibold text-gray-900 text-lg mt-4">Monthly EMI: <span id="emiValue">₹0</span></p>
    </div>
  </main>

  <div id="site-footer"></div>

  <script>
  let manualLoanEdit = false;
  let toastTimeout = null;

  function showToast(message, type = "warning") {
    const oldToast = document.getElementById("toastMessage");
    if (oldToast) oldToast.remove();
    const toast = document.createElement("div");
    toast.id = "toastMessage";
    toast.innerText = message;
    toast.className = `fixed bottom-6 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg text-white shadow-lg z-50 transition-opacity duration-500 ${
      type === "warning" ? "bg-red-600" : "bg-emerald-600"
    }`;
    document.body.appendChild(toast);
    clearTimeout(toastTimeout);
    toastTimeout = setTimeout(() => {
      toast.style.opacity = "0";
      setTimeout(() => toast.remove(), 400);
    }, 2000);
  }

  function formatINR(v) {
    return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(v);
  }

  function updateSliderFill(slider) {
    const min = slider.min || 0, max = slider.max || 100, value = slider.value;
    const pct = ((value - min) * 100) / (max - min);
    slider.style.background = `linear-gradient(to right,#10B981 0%,#10B981 ${pct}%,#e5e7eb ${pct}%,#e5e7eb 100%)`;
  }

  function calculateHomeLoan() {
    const P = parseFloat(document.getElementById('loanAmount').value) || 0;
    const rA = parseFloat(document.getElementById('rate').value) || 0;
    const yrs = parseFloat(document.getElementById('years').value) || 0;
    const r = rA / 12 / 100, n = yrs * 12;
    let emi = 0, total = 0, intst = 0;
    if (P > 0 && r > 0 && n > 0) {
      const x = Math.pow(1 + r, n);
      emi = (P * r * x) / (x - 1);
      total = emi * n;
      intst = total - P;
    }
    document.getElementById('emiValue').innerText = formatINR(emi.toFixed(0));
    document.getElementById('principalText').innerText = formatINR(P.toFixed(0));
    document.getElementById('interestText').innerText = formatINR(intst.toFixed(0));

    const totalSum = P + intst || 1;
    const pPct = (P / totalSum) * 100, iPct = (intst / totalSum) * 100;
    document.getElementById('principalArc').setAttribute('stroke-dasharray', `${pPct} ${100 - pPct}`);
    document.getElementById('interestArc').setAttribute('stroke-dasharray', `${iPct} ${100 - iPct}`);
    document.getElementById('interestArc').setAttribute('stroke-dashoffset', -pPct);
  }

  function syncLoanAmount() {
    const property = parseFloat(document.getElementById('propertyValue').value) || 0;
    const downInput = document.getElementById('downPayment');
    const loanInput = document.getElementById('loanAmount');
    const downBar = document.getElementById('downBar');
    const loanBar = document.getElementById('loanBar');

    let down = parseFloat(downInput.value) || 0;
    let loan = parseFloat(loanInput.value) || 0;

    if (down > property) {
      down = property;
      downInput.value = property;
      showToast("⚠️ Down payment cannot exceed property value");
    }
    if (loan > property) {
      loan = property;
      loanInput.value = property;
      showToast("⚠️ Loan amount cannot exceed property value");
    }

    if (!manualLoanEdit) {
      loan = Math.max(property - down, 0);
      loanInput.value = loan.toFixed(0);
    } else {
      down = Math.max(property - loan, 0);
      downInput.value = down.toFixed(0);
    }

    const downPct = property > 0 ? (down / property) * 100 : 0;
    const loanPct = property > 0 ? (loan / property) * 100 : 0;
    downBar.style.width = `${downPct}%`;
    loanBar.style.width = `${loanPct}%`;

    downInput.max = property;
    loanInput.max = property;

    calculateHomeLoan();
  }

  document.getElementById('propertyValue').addEventListener('input', () => { manualLoanEdit = false; syncLoanAmount(); });
  document.getElementById('downPayment').addEventListener('input', () => { manualLoanEdit = false; syncLoanAmount(); });
  document.getElementById('loanAmount').addEventListener('input', () => { manualLoanEdit = true; syncLoanAmount(); });

  ['rate', 'years'].forEach(id => {
    const input = document.getElementById(id), slider = document.getElementById(id + 'Slider');
    const updateAll = () => { slider.value = input.value; updateSliderFill(slider); calculateHomeLoan(); };
    input.addEventListener('input', updateAll);
    slider.addEventListener('input', () => { input.value = slider.value; updateSliderFill(slider); calculateHomeLoan(); });
    updateSliderFill(slider);
  });

  syncLoanAmount();

  Promise.all([
    fetch("header.html").then(r => r.text()).then(h => (document.getElementById("site-header").innerHTML = h)),
    fetch("sidebar.html").then(r => r.text()).then(h => (document.getElementById("site-sidebar").innerHTML = h)),
    fetch("footer.html").then(r => r.text()).then(h => (document.getElementById("site-footer").innerHTML = h))
  ]).then(() => {
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const menuBtn = document.getElementById("menuBtn");
    const closeSidebar = document.getElementById("closeSidebar");

    function openSidebar() { sidebar?.classList.remove("-translate-x-full"); overlay?.classList.remove("hidden"); }
    function closeSidebarFunc() { sidebar?.classList.add("-translate-x-full"); overlay?.classList.add("hidden"); }

    menuBtn?.addEventListener("click", openSidebar);
    closeSidebar?.addEventListener("click", closeSidebarFunc);
    overlay?.addEventListener("click", closeSidebarFunc);
  });
  </script>
</body>
</html>
